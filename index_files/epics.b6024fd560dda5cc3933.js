/*! For license information please see epics.b6024fd560dda5cc3933.js.LICENSE.txt */
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d51df5cf-f155-47a5-992a-4b1284d60e93",e._sentryDebugIdIdentifier="sentry-dbid-d51df5cf-f155-47a5-992a-4b1284d60e93")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"95f33afaeb90790a7fa3e414dcea3853ce67b293"},(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{2374:function(e,t,o){"use strict";var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.createPointData=void 0;var r=a(o(23)),i=o(1746);const n=["ignoreHistory","withoutRedo"];t.createPointData=function(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{ignoreHistory:c=!1,withoutRedo:l=!1}=t,s=(0,r.default)(t,n);return{date:Date.now(),options:a,ignoreHistory:c,withoutRedo:l,pageId:a.pageId||(0,i.getCurrentPage)(o),action:{type:e,payload:s}}}},2658:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrgFulfilledAction=t.fetchOrgAction=t.FETCH_ORGANIZATION=void 0;var a=o(1688);const r=t.FETCH_ORGANIZATION="FETCH_ORGANIZATION";t.fetchOrgAction=e=>({type:r,payload:e});t.fetchOrgFulfilledAction=e=>({type:(0,a.withFulfilledType)(r),payload:e})},3132:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getNewHomepage=t.checkPageAndRedirectHome=void 0;var a=o(2023),r=o(1746),i=o(783);const n=t.getNewHomepage=e.pipe(e.entries,e.filter((e=>{let[,t]=e;return!t.websiteApplication})),e.filter((e=>{let[,t]=e;return!t.metadata.parentId})),e.sortBy((e=>{let[,t]=e;return t.sortOrder||0})),e.head);t.checkPageAndRedirectHome=(t,o)=>{let{websiteId:c,pages:l,location:s}=t;const p=(0,r.getCurrentPage)(o);if(!Object.keys(l).includes(p)){const t=e.findKey((e=>{let{metadata:t}=e;return t.homepage}),l)||e.flow(n,e.get("0"))(l),o=s.pathname.match(/\/editor\/(website|structure|comment)\/(.+)/);if(o){const[,e]=o,r=(0,i.getLanguageFromPath)(),n=r?`/${r}`:"";return(0,a.replace)(`${n}/editor/${e}/${c}/${t}${s.search||""}`)}return null}}}).call(this,o(17))},3133:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getAverageSortOrder=t.SORT_POSITION_TOP=t.SORT_POSITION_BOTTOM=void 0;var a=o(2554);t.SORT_POSITION_TOP="top",t.SORT_POSITION_BOTTOM="bottom";t.getAverageSortOrder=t=>{let{blocks:o,position:r}=t;const i=(0,a.sortBlocks)(o);if(!i.length)return 1;if(r>=i.length)return e.pipe(e.last,e.prop(e.__,o),e.prop("sortOrder"),e.add(1))(i);const n=i[r],c=i[r-1];return e.flow(e.compact,e.map((e=>{const{sortOrder:t}=o[e];return t})),e.sum)([n,c])/2}}).call(this,o(17))},4384:function(e,t,o){"use strict";var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.epics=t.default=void 0;var r=o(2024),i=a(o(9396)),n=o(9397),c=o(9398),l=o(9399),s=o(9413),p=o(9430),d=o(9432),u=o(9433),g=o(9434),f=o(9435),y=o(9440),O=o(9442),E=o(9443),b=o(9444),P=o(9445),h=a(o(9446)),m=a(o(3857)),T=a(o(9447)),_=a(o(9448)),v=a(o(9449));const A=t.epics={editorStatusEpic:b.editorStatusEpic,undoRedoEpic:f.undoRedoEpic,externalUpdateUndo:f.externalUpdateUndo,permissionEpic:n.permissionEpic,changeLocationEpic:c.changeLocationEpic,blocksEpic:s.blocksEpic,pagesEpic:l.pagesEpic,uiKitEpic:p.uiKitEpic,fetchBlockTemplatesEpic:d.fetchBlockTemplatesEpic,fetchViewsEpic:u.fetchViewsEpic,fetchWebsiteEpic:g.fetchWebsiteEpic,fetchOrganizationEpic:P.fetchOrganizationEpic,updateWebsiteEpic:g.updateWebsiteEpic,themesEpic:y.themesEpic,modalsEpic:O.modalsEpic,commentsEpic:E.commentsEpic,getWebsiteAppsEpic:g.getWebsiteAppsEpic,popupsEpic:i.default,popupTemplatesEpic:h.default,ecommerceEpic:m.default,phrasesEpic:T.default,loadingBlocksEpic:_.default,shapeEpic:v.default};t.default=(0,r.combineEpics)(...Object.values(A))},4385:function(e,t,o){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.toggleHiddenStatusEpic=t.toggleHiddenRoles=void 0;var r=o(1746),i=o(1691),n=o(1745),c=o(1741),l=o(1711),s=o(1683),p=o(1677),d=o(386),u=o(2249),g=o(1967),f=o(1688);const y=e.values(p.DEVICE_HIDDEN_ROLES),O=e.getOr([],"roles"),E=e.cond([[l.isHiddenOnAllDevices,e.pipe(O,e.without(y))],[e.T,e.pipe(O,a.concatRearg(y),e.uniq)]]),b=e.curry(((t,o)=>a.ifElse((0,l.isHiddenOnDeviceType)(t),e.pipe(O,e.without([(0,u.getRoleByDevice)(t)])),e.pipe(O,a.concatRearg((0,u.getRoleByDevice)(t))))(o))),P=t.toggleHiddenRoles=e.curry(((t,o)=>a.ifElse(e.always(e.equals(t,p.ALL_DEVICE_TYPE)),E,b(t))(o)));t.toggleHiddenStatusEpic=(t,o)=>{const a=(0,i.makeBlockSelector)();return t.ofType(i.TOGGLE_HIDDEN_STATUS,(0,f.withUndoType)(i.TOGGLE_HIDDEN_STATUS),(0,f.withRedoType)(i.TOGGLE_HIDDEN_STATUS)).withLatestFrom(o).switchMap((t=>{let[{payload:{id:o,deviceType:u}},f]=t;const y=e.includes(u,[...p.ALL_DEVICES,p.ALL_DEVICE_TYPE])?u:(0,s.selectCurrentDevice)(f),O=(0,r.getCurrentPage)(f),E=(0,c.getCurrentPage)(f),b=a(f,o);if((0,l.isSpawning)(b)){const e=(0,g.getPushMergeBlocksRoles)(b.anchor,E),t=P(y,{roles:e}),o=(0,g.setPushMergeBlocksRoles)(b.anchor,E,t);return d.Observable.of((0,n.updatePageAction)({pageId:O,data:{merge_blocks:o}},{ignoreHistory:!0}))}const h=P(y,b);return d.Observable.of((0,i.updateBlockAction)(o,{roles:h}))}))}}).call(this,o(17),o(29))},9396:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPopupEpic=t.default=t.closePopupEditorEpic=void 0;var r=a(o(3)),i=o(2248),n=o(535),c=o(2917),l=o(1691),s=o(386),p=o(2556);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const g=(t,o)=>t.ofType(i.FETCH_POPUP).switchMap((async e=>{const t=e.payload,o=await(0,n.getBlockData)(t),a=u(u({},o),{},{id:t,roles:o.roles||[]}),r=await(0,c.buildBlockData)(t,a);return await(0,c.getAndSetView)(a),[(0,l.fetchBlockFulfilledAction)(t,r),(0,p.fetchViewFulfilledAction)(r.viewRef),(0,i.fetchPopupFulfilledAction)(r)]})).switchMap(e.apply(s.Observable.of));t.fetchPopupEpic=g;const f=(e,t)=>e.ofType(i.CLOSE_POPUP_EDITOR).switchMap((()=>{const{popups:e}=t.value,o=Object.keys(e);return[(0,i.closePopupEditorFulfilledAction)(o)]}));t.closePopupEditorEpic=f;t.default=(e,t)=>s.Observable.merge(g(e),f(e,t))}).call(this,o(17))},9397:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.permissionEpic=void 0;var a=o(2023),r=o(1688);const i=[a.LOCATION_CHANGE,a.CALL_HISTORY_METHOD];t.permissionEpic=e=>e.filter((e=>!(0,r.hasPermission)(e.type)&&!i.includes(e.type))).map(r.withPermission)},9398:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeLocationEpic=void 0;var a=o(386),r=o(2023),i=o(1809),n=o(1745),c=o(1895),l=o(1988),s=o(1691),p=o(1688),d=o(783),u=o(838),g=o(781),f=o(1698);t.changeLocationEpic=(t,o)=>a.Observable.merge(t.ofType(l.START).switchMap((()=>{const e=(0,g.getHistory)();return a.Observable.of((0,r.replace)({pathname:e.location.pathname,state:e.location.state}))})),t.ofType(r.LOCATION_CHANGE).withLatestFrom(o).filter((t=>{let[{payload:{location:{pathname:o=""}}},a]=t;const r=(0,f.pagesSelector)(a);return!e.isEmpty(r)&&!o.includes("/editor/")})).switchMap((()=>a.Observable.merge(a.Observable.of((0,c.closeAllModalsAction)()),a.Observable.of((0,n.unReadyPageAction)()),a.Observable.of((0,i.cleanWebsiteAction)()),a.Observable.of((0,s.cleanBlocksAction)())))),t.ofType(l.START).filter((()=>{const{auth:e}=o.value;return e})).map((()=>(t=>{const o=e.getOr(null,["router","location","pathname"],t),a=o.match(d.LANG_URL_REGEXP),r=a&&e.includes(a[1],u.ACCOUNT_LANGUAGES)?a[1]:null,i=r?`/${r}/`:"/editor";if(e.startsWith(i,o)){const e=o.split("/");return r?e[4]:e[3]}return null})(o.value))).switchMap((c=>a.Observable.merge(a.Observable.of((0,i.fetchWebsiteAction)(c)),t.ofType((0,p.withPermissionType)((0,p.withFulfilledType)(n.FETCH_PAGES))).switchMap((()=>a.Observable.merge(a.Observable.of(null),t.ofType(r.LOCATION_CHANGE)))).map((()=>{const t=e.get("router.location.pathname")(o.value);return e.last(t.split("/"))})).distinctUntilChanged().withLatestFrom(o).filter((e=>{let[t,o]=e;return(0,f.selectPageById)(t,o)})).map((e=>{let[t]=e;return(0,s.fetchBlocksAction)(t)}))))),t.ofType(l.PRE_CHANGE_LOCATION).switchMap((e=>{let{payload:{path:o,onPageReadyAction:i}}=e;return a.Observable.merge(a.Observable.of((0,r.push)(o)),t.ofType((0,p.withPermissionType)(n.READY_PAGE)).take(1).map((()=>i)))})))}).call(this,o(17))},9399:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pagesEpic=void 0;var a=o(2024),r=o(9400),i=o(9401),n=o(9402),c=o(9403),l=o(9404),s=o(9405),p=o(9406),d=o(9407),u=o(9409),g=o(9411),f=o(9412);t.pagesEpic=(0,a.combineEpics)(i.fetchPagesEpic,c.createPageEpic,u.clonePageEpic,d.removePageEpic,s.changePageMetadataEpic,l.changePageOrderEpic,n.externalPageRemoveEpic,p.changePageMetadataPropEpic,r.updatePageEpic,g.setHomepageEpic,f.changePageLangGroupEpic)},9400:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePageEpic=void 0;var a=o(1745),r=o(1688),i=o(535),n=o(1698),c=o(1708);t.updatePageEpic=(e,t)=>e.ofType(a.UPDATE_PAGE,(0,r.withUndoType)(a.UPDATE_PAGE),(0,r.withRedoType)(a.UPDATE_PAGE)).withLatestFrom(t).mergeMap((async e=>{let[{payload:t},o]=e;const{pageId:l,data:s}=t,p=(0,n.pagesSelector)(o),d=(0,c.selectWebsiteId)(o);if(p[l])try{return await(0,i.updateWebsitePage)({websiteId:d,pageId:l,data:s}),(0,a.updatePageFulfilledAction)({pageId:l,data:s})}catch(u){return console.log("error changing page",u),{type:(0,r.withRejectType)(a.UPDATE_PAGE)}}})).filter(Boolean)},9401:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPagesEpic=void 0;var a=o(1745),r=o(535),i=o(3132),n=o(386),c=o(1988);t.fetchPagesEpic=(t,o)=>t.ofType(a.FETCH_PAGES).withLatestFrom(o).mergeMap((async e=>{let[{payload:{websiteId:t}},o]=e;const n=await(0,r.getWebsitePages)(t),l=(0,c.selectRouterLocation)(o);return[(0,a.fetchPagesFulfilledAction)({pages:n}),(0,i.checkPageAndRedirectHome)({websiteId:t,pages:n,location:l},o)].filter(Boolean)})).mergeMap(e.spread(n.Observable.of))}).call(this,o(17))},9402:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.externalPageRemoveEpic=void 0;var a=o(1856),r=o(1988),i=o(1708),n=o(1698),c=o(3132);t.externalPageRemoveEpic=(t,o)=>t.ofType(a.EXTERNAL_PAGE_REMOVE).withLatestFrom(o).map((t=>{let[{payload:{id:o}},a]=t;const l=(0,r.selectRouterLocation)(a),s=(0,i.selectWebsiteId)(a),p=(0,n.pagesSelector)(a);return(0,c.checkPageAndRedirectHome)({websiteId:s,pages:e.omit(o)(p),location:l},a)})).filter(Boolean)}).call(this,o(17))},9403:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.createPageEpic=void 0;var r=a(o(23)),i=a(o(3)),n=o(1745),c=o(1708),l=o(1741),s=o(386),p=o(535),d=o(1688),u=o(1711),g=o(855),f=o(1804),y=o(1967);const O=["_id","slug"];function E(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function b(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?E(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):E(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.createPageEpic=(t,o)=>t.ofType(n.CREATE_PAGE).mergeMap((t=>{let{payload:{sortOrder:a,metadata:i}}=t;const d=o.value,u=(0,c.selectWebsiteId)(d),g=(0,l.pagesSelector)(d),E=(0,f.currentLanguageSelector)(d),P=((e,t)=>{if(t)return e.filter((e=>e.lang===t)).every((e=>e.roles.includes("hidden")))?["hidden"]:void 0})(e.values(g),E),h=b({roles:P,metadata:b(b({},i),{},{slug:(0,y.generateUniqSlug)({metadata:i,pages:g,lang:E}),homepage:!1}),sortOrder:a},E&&{lang:E});return s.Observable.fromPromise((0,p.addWebsitePage)({id:u,data:h})).map((e=>{let[t]=e,{_id:o,slug:a}=t,i=(0,r.default)(t,O);return(0,n.createPageFulfilledAction)({pageId:o,data:b(b(b({},i),h),{},{slug:a,langGroup:i.lang_group})})})).catch((()=>[]))})).ofType((0,d.withFulfilledType)(n.CREATE_PAGE)).do((async e=>{let{payload:{pageId:t}}=e;const a=(0,c.selectWebsiteId)(o.value),r=(0,u.genLocation)(t);try{const e=await(0,g.getCustomBlock)();if(e){const{_id:t,roles:o,categories:[i]}=e;(0,p.createBlockOnLocation)({websiteId:a,location:r,source:t,anchorName:i,roles:o,sortOrder:1})}}catch(i){console.error(i)}}))}).call(this,o(17))},9404:function(e,t,o){"use strict";var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageOrderEpic=void 0;var r=a(o(3)),i=o(1745),n=o(535),c=o(1967);function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.changePageOrderEpic=(e,t)=>e.ofType(i.CHANGE_PAGE_ORDER).concatMap((async e=>{let{payload:{pages:o,changedPage:a}}=e;const{website:{_id:r},pages:l}=t.value;try{const e=l[a.id],t={metadata:s(s({},a.metadata),{},{slug:a.metadata.parentId!==e.metadata.parentId?(0,c.generateUniqSlug)({pages:o,metadata:a.metadata,slugId:a.slug,lang:a.lang}):a.metadata.slug}),sortOrder:a.sortOrder};return await(0,n.updateWebsitePage)({websiteId:r,pageId:a.id,data:t}),(0,i.changePageOrderFulfilledAction)({changedPage:s(s({},a),t)})}catch(p){return{type:""}}})).filter(Boolean)},9405:function(e,t,o){"use strict";var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataEpic=void 0;var r=a(o(3)),i=o(1745),n=o(1688),c=o(535),l=o(1967);function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.changePageMetadataEpic=(e,t)=>e.ofType(i.CHANGE_PAGE_METADATA,(0,n.withUndoType)(i.CHANGE_PAGE_METADATA),(0,n.withRedoType)(i.CHANGE_PAGE_METADATA)).mergeMap((async e=>{let{payload:o}=e;const{pageId:a}=o,{pages:r,website:{_id:s}}=t.value;if(r[a])try{const{metadata:e,slug:t,lang:n}=r[a],d=p(p({},e),o.metadata);d.parentId!==e.parentId&&(d.slug=(0,l.generateUniqSlug)({metadata:d,pages:r,slugId:t,lang:n}));const u=await(0,c.updateWebsitePage)({websiteId:s,pageId:a,data:{metadata:d}});return(0,i.changePageMetadataFulfilledAction)(p({pageId:a,metadata:d},u))}catch(d){return console.log("error changing page metadata",d),{type:(0,n.withRejectType)(i.CHANGE_PAGE_METADATA)}}})).filter(Boolean)},9406:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changePageMetadataPropEpic=void 0;var a=o(1745),r=o(1688),i=o(535),n=o(386);t.changePageMetadataPropEpic=(e,t)=>e.ofType(a.CHANGE_PAGES_METADATA_PROP,(0,r.withUndoType)(a.CHANGE_PAGES_METADATA_PROP),(0,r.withRedoType)(a.CHANGE_PAGES_METADATA_PROP)).mergeMap((async e=>{let{type:o,payload:{key:a,value:r,pages:n}}=e;const{website:{_id:c}}=t.value;try{const{ok:e}=await(0,i.updatePagesMetadataProp)({websiteId:c,key:a,value:r,pages:n});return e&&{type:o,key:a,value:r,pages:n}}catch(l){return{type:""}}})).filter(Boolean).mergeMap((e=>{let{key:t,value:o,pages:r}=e;return n.Observable.of((0,a.changePagesMetadataPropFulfilledAction)({key:t,value:o,pages:r})).filter(Boolean)}))},9407:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.removePageEpic=void 0;var r=a(o(3)),i=o(386),n=o(1745),c=o(535),l=o(1688),s=o(9408),p=o(1932),d=o(1988),u=o(1708),g=o(1698),f=o(1949),y=o(3132);function O(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function E(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?O(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.removePageEpic=(t,o)=>t.ofType(n.REMOVE_PAGE).withLatestFrom(o).concatMap((async a=>{let[{payload:{pageId:r,removeSubpages:O}},b]=a;const P=(0,d.selectRouterLocation)(b),h=(0,u.selectWebsiteId)(b),m=(0,g.pagesSelector)(b);if(!m[r])return[];let T=[],_=[];try{await(0,c.removeWebsitePage)({id:h,pageId:r}),O?T=await(async(t,o,a)=>{const r=e.pipe(e.pickBy((e=>e.metadata.parentId===o[t].slug)),e.keys)(o);for(const e of r)await(0,c.removeWebsitePage)({id:a,pageId:e});return r})(r,m,h):_=await(async(t,o,a)=>{const r=(0,p.getPagesBySortOrder)(o).filter((e=>{let{id:o}=e;return o!==t})),i=e.filter((e=>e.metadata.parentId===o[t].slug),r),n=e.findIndex({metadata:{parentId:o[t].slug}},r),l=e.findLastIndex({metadata:{parentId:o[t].slug}},r),s=r[n-1],d=r[l+1];let u=null,g=null;s&&d?(u=(0,p.getSortOrder)(s),g=(0,p.getSortOrder)(d)):!s&&d?(g=(0,p.getSortOrder)(d),u=g-i.length):s&&!d?(u=(0,p.getSortOrder)(s),g=u+i.length):s||d||(u=0,g=0);const f=(g-u)/(i.length+1),y=i.map(((e,t)=>{const o=u+f*(t+1);return E(E({},e),{},{sortOrder:o,metadata:E(E({},e.metadata),{},{parentId:null})})}));for(const p of y){const t=e.pick(["sortOrder","metadata"],p);await(0,c.updateWebsitePage)({websiteId:a,pageId:p.id,data:t})}return y})(r,m,h)}catch(S){return i.Observable.of({type:""})}const v=(0,f.isHomepage)(m[r]),A=(0,s.dispatchWaitMergeCreator)(t),w=()=>i.Observable.of(...e.compact([(0,y.checkPageAndRedirectHome)({websiteId:h,pages:e.omit([r],m),location:P},b)]));return A((0,n.removePageFulfilledAction)({pageIds:[r,...T],removeSubpages:O,pagesWithRemovedParent:_}),(0,l.withPermissionType)((0,l.withFulfilledType)(n.REMOVE_PAGE)),(()=>{const e=(0,y.getNewHomepage)(o.value.pages);return v?A((0,n.changePageMetadataAction)({pageId:e[0],metadata:E(E({},e[1].metadata),{},{homepage:!0})}),(0,l.withPermissionType)((0,l.withFulfilledType)(n.CHANGE_PAGE_METADATA)),w):w()}))})).mergeMap(e.identity)}).call(this,o(17))},9408:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dispatchWaitMergeCreator=void 0;var a=o(386);t.dispatchWaitMergeCreator=e=>(t,o,r)=>a.Observable.merge(e.ofType(o).first().mergeMap(r),a.Observable.of(t))},9409:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.clonePageEpic=void 0;var i=r(o(3)),n=o(1745),c=o(535),l=o(9410),s=o(1777),p=o(2250),d=o(1967);function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.clonePageEpic=(t,o)=>t.ofType(n.CLONE_PAGE).mergeMap((async t=>{let{payload:{pageId:r,data:i={}}}=t;const{website:{_id:u},pages:f}=o.value,{metadata:y,metadata:{displayName:O},lang:E}=f[r],b=e.pipe(a.keyToProp("id"),e.sortBy(e.getOr(0,"sortOrder")))(f),P=e.findIndex({id:r},b),h=b[P],m=b[P+1],T=m?(e.getOr(0,"sortOrder",h)+e.getOr(0,"sortOrder",m))/2:e.getOr(0,"sortOrder",h)+1,_=(0,p.getMetadataForClonedPage)(y),v=e.values(f),A=i.lang&&E!==i.lang,w=f[r],S=A?v.find((e=>e.lang===i.lang&&e.lang_group===w.lang_group)):null,j=await(async(e,t,o)=>{if(!o)return;return o===t.lang||e.find((e=>e.lang===o&&e.lang_group===t.lang_group))?(0,c.getNewId)().data():t.lang_group})(v,w,i.lang),k=((e,t,o,a)=>{const{roles:r=[]}=e;if(o){const o=(0,p.isHidden)(e);return(0,s.getLanguageVisibility)(t,{lang:a})||o?r.filter((e=>"hidden"!==e)):[...r,"hidden"]}return r})(w,f,A,i.lang),C={roles:k,metadata:g(g({},_),{},{slug:A&&!S?y.slug:(0,d.generateUniqSlug)({metadata:_,pages:f,lang:A?i.lang:E}),displayName:(0,l.generateDuplicateName)(A?v.filter((e=>e.lang===i.lang)):v,O,"metadata.displayName"),parentId:A?null:e.getOr(null,"parentId",_)}),sortOrder:T,lang:i.lang?i.lang:E,langGroup:j,merge_blocks:w.merge_blocks};try{const{pageId:e,slug:t}=await(0,c.cloneWebsitePage)({id:u,data:C,pageId:r});return(0,n.createPageFulfilledAction)({pageId:e,data:g(g({},C),{},{slug:t,lang_group:j,langGroup:j,website_lang:w.website_lang})})}catch(M){return{type:""}}}))}).call(this,o(17),o(29))},9410:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.generateDuplicateName=void 0;t.generateDuplicateName=function(t,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name";const r="copy",i=new RegExp(`\\s${r}\\s*(\\d+)\\s*$`,"i"),n=e.get(a);o=o?o.trim().replace(i,""):"";const c=t.filter((e=>n(e).startsWith(o))).map((e=>{const[,t]=n(e).match(i)||[];return void 0===t?0:+t})),l=Math.max(...c,0);return`${o} ${r} ${l+1}`}}).call(this,o(17))},9411:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.setHomepageEpic=void 0;var r=a(o(3)),i=o(1698),n=o(535),c=o(1688);function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.setHomepageEpic=(t,o)=>t.ofType(i.SET_HOMEPAGE).mergeMap((async t=>{const{pageId:a}=t.payload,r=(0,i.pagesSelector)(o.value),l=o.value.website._id,p=r[a],d=e.values(r),u=d.find(e.get("metadata.homepage")),g=u.langGroup,f=await(0,n.getNewId)().data();try{if(p.lang===p.website_lang)return await(0,n.updateWebsitePage)({websiteId:l,pageId:u._id,data:{lang_group:f}}),await(0,n.updateWebsitePage)({websiteId:l,pageId:a,data:{lang_group:g,metadata:s(s({},p.metadata),{},{homepage:!0})}}),(0,i.setHomepageFulfilledAction)({pageId:a,oldPageId:u._id,homepageLangGroup:g,oldPageNewLangGroup:f,realHomepage:!0});const e=d.find((e=>e.lang===p.lang&&e.langGroup===g));return await(0,n.updateWebsitePage)({websiteId:l,pageId:e._id,data:{lang_group:f}}),await(0,n.updateWebsitePage)({websiteId:l,pageId:a,data:{lang_group:g}}),(0,i.setHomepageFulfilledAction)({pageId:a,oldPageId:e._id,homepageLangGroup:g,oldPageNewLangGroup:f})}catch(y){return{type:(0,c.withRejectType)(i.SET_HOMEPAGE)}}}))}).call(this,o(17))},9412:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changePageLangGroupEpic=void 0;var a=o(1745),r=o(1688),i=o(535);t.changePageLangGroupEpic=(e,t)=>e.ofType(a.CHANGE_PAGE_LANG_GROUP,(0,r.withUndoType)(a.CHANGE_PAGE_LANG_GROUP),(0,r.withRedoType)(a.CHANGE_PAGE_LANG_GROUP)).mergeMap((async e=>{let{payload:o}=e;const{selectedPageId:n,pageId:c,langGroup:l}=o,{pages:s,website:{_id:p}}=t.value;try{return n&&s[n]&&await(0,i.updateWebsitePage)({websiteId:p,pageId:n,data:{lang_group:null}}),c&&s[c]&&await(0,i.updateWebsitePage)({websiteId:p,pageId:c,data:{lang_group:l}}),(0,a.changePageLangGroupFulfilledAction)({selectedPageId:n,pageId:c,langGroup:l})}catch(d){return console.log("error changing page",d),{type:(0,r.withRejectType)(a.CHANGE_PAGE_LANG_GROUP)}}})).filter(Boolean)},9413:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blocksEpic=void 0;var a=o(2024),r=o(9414),i=o(9415),n=o(2917),c=o(9418),l=o(9419),s=o(9420),p=o(4385),d=o(9423),u=o(9425),g=o(9426),f=o(9427),y=o(9428),O=o(9429);t.blocksEpic=(0,a.combineEpics)(r.changeSortOrderEpic,i.createBlockEpic,n.fetchBlocksEpic,c.cloneBlockEpic,l.cloneBlockToPagesEpic,s.cloneBlockToLanguagesEpic,p.toggleHiddenStatusEpic,d.toggleHiddenStatusOnAllPagesEpic,u.removeBlockEpic,g.serverUpdateBlockEpic,O.updateBlockModifierEpic,f.updateBlockEpic,y.updateToSourceEpic)},9414:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.changeSortOrderEpic=void 0;var a=o(1688),r=o(1691),i=o(2554);t.changeSortOrderEpic=(t,o)=>t.ofType(r.CHANGE_SORT_ORDER,(0,a.withRedoType)(r.CHANGE_SORT_ORDER),(0,a.withUndoType)(r.CHANGE_SORT_ORDER)).switchMap((t=>{let{payload:{id:a,targetId:n,position:c}}=t;const{blocks:l}=o.value,s=l[n];if(!s)return[];let p;p="before"===c?(0,i.calcNewOrders)(a,"decrease",e.set(`${a}.sortOrder`,s.sortOrder+1e-4,l)):(0,i.calcNewOrders)(a,"increase",e.set(`${a}.sortOrder`,s.sortOrder-1e-4,l));return Object.keys(p).map((e=>{const t=p[e];return(0,r.updateBlockFulfilledAction)(e,{sortOrder:t})}))}))}).call(this,o(17))},9415:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.createBlockEpic=void 0;var i=r(o(3)),n=r(o(23)),c=o(386),l=o(1691),s=o(1745),p=o(1741),d=o(1967),u=o(1809),g=o(1895),f=o(9416),y=o(1904),O=o(1833),E=o(810),b=o(535),P=o(1958),h=o(3851),m=o(1680),T=o(1688),_=o(2901),v=o(3133);const A=["location","categories","position","sortOrder","anchorName","askLocation","noScroll","roles"];function w(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function S(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?w(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const j=e.propSatisfies("roles",a.includes("removed")),k=e=>{let{location:t,pageBlocks:o,position:r}=e;return a.startsWith("WebsitePage:",t)?(0,v.getAverageSortOrder)({blocks:o,position:r}):0};t.createBlockEpic=(t,o)=>t.ofType(l.CREATE_BLOCK).mergeMap((async r=>{let{payload:{source:i,createBlockProps:{location:v,categories:w,position:C,sortOrder:M,anchorName:D,askLocation:R,noScroll:I,roles:L},isTargetGlobalBlock:B}}=r,G=(0,n.default)(r.payload.createBlockProps,A);try{const r=o.value,n=(0,P.incrementAnchor)({anchorName:D,blocks:r.blocks,categories:w,roles:L}),{blocks:A}=r,U=a.pickBy(a.propEq("location",v),A);let H;if(!I)if("header"===v)H=0;else if("footer"===v)H=document.body.getBoundingClientRect().height;else{const t=a.size(U),o=C===a.size(U)||C===Number.POSITIVE_INFINITY,r=t?a.pipe(e.keyToProp("id"),a.sortBy("sortOrder"),a.nth(Math.min(t-1,o?C-1:C)))(U):a.find(a.propEq("location","header"),A);if(r){const e=document.getElementById(j(r)?`block-removed-${r.id}`:`blockId-${r.id}`),{top:t,bottom:a}=e?e.getBoundingClientRect():0,i="header"===r.location||o?a:t;H=i+window.scrollY-100}}const F=a.path(["website","_id"])(r),{block:W,block:{id:K,anchor:V,source:x}}=await(0,b.createBlockOnLocation)(S(S({},G),{},{anchorName:n,source:i,websiteId:F,location:v,sortOrder:M||k({location:v,pageBlocks:U,position:C}),roles:L}));let $=null,Y=[];if(B&&x){const e=(0,p.getCurrentPage)(r),{anchor:t}=(0,l.makeBlockSelector)()(r,x),o=a.pipe(a.map((e=>{const o=(0,d.getPushMergeBlocksRoles)(t,e);if(a.isEmpty(o))return null;const r=(0,d.setPushMergeBlocksRoles)(V,e,o);return(0,s.updatePageAction)({pageId:e.id,data:{merge_blocks:r}},{ignoreHistory:!0})})),a.compact)(a.values((0,p.currentLangPagesSelector)(r)));$=a.find(a.pipe(a.get("payload.pageId"),a.equals(e.id)),o),Y=a.reject($,o)}const q=(0,h.getAppsByRoles)(W.roles),z=[];q.forEach((e=>{let{application:t}=e;z.push((async()=>{await(0,y.installAndSetApp)({websiteId:F,application:t,type:"editor"}),"blog"===t&&((0,O.trigger)("blog_installed_feed"),(0,E.pushEvent)({event:"Blog Connected",eventCategory:"Apps",eventAction:"Blog",eventLabel:"Connected"}))})())}));try{await Promise.all(z)}catch(N){console.error(N)}const J=await(0,_.getBlockContent)(W),{router:{location:{pathname:X}}}=o.value,[,Z]=v.split(":");if(Z&&!X.match(Z))return[];null!=H&&setTimeout((()=>(0,m.smoothyScrollTo)(H,400,"easeInOutCirc")),0);const Q=c.Observable.of(...Y,(0,g.closeAllModalsAction)(),(0,l.createBlockFulfilledAction)(K,S(S(S({},G),W),{},{content:J,anchorName:n})),R&&(0,g.openModalAction)({id:f.BindedBlockModal.id,props:{location:R,roles:W.roles,blockId:K}}),(0,u.getWebsiteAppsAction)()).filter(Boolean);return $?c.Observable.merge(c.Observable.of($),t.ofType((0,T.withPermissionType)((0,T.withFulfilledType)(s.UPDATE_PAGE))).take(1).mergeMap((()=>Q))):Q}catch(U){return[]}})).switchMap(a.identity)}).call(this,o(29),o(17))},9416:function(e,t,o){"use strict";(function(e,a,r){var i=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.BindedBlockModal=void 0;var n=i(o(307)),c=i(o(61)),l=i(o(109)),s=i(o(75)),p=o(0),d=o(1664),u=o(1670),g=o(1691),f=o(253),y=o(1680),O=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=h(t);if(o&&o.has(e))return o.get(e);var a={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(a,i,n):a[i]=e[i]}return a.default=e,o&&o.set(e,a),a}(o(1669)),E=o(1698),b=o(1777),P=i(o(9417));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(h=function(e){return e?o:t})(e)}const m={header:(0,f.getStringByKey)("add-header-block"),footer:(0,f.getStringByKey)("add-footer-block")};t.BindedBlockModal=r.compose(u.registerModal,(0,O.default)((0,O.asMapDispatch)((e=>({updateBlockAction:(t,o,a)=>{let{location:r,roles:i}=o;return e((0,g.updateBlockAction)(t,{location:r,roles:i},a))}})))))((t=>{let{blockId:o,location:r,roles:i,closeModal:u,updateBlockAction:g}=t;const O=(0,d.useSelector)(E.selectCurrentPageLanguage),h=(0,p.useCallback)((async()=>{let e;"header"===r?e=0:"footer"===r&&(e=document.body.getBoundingClientRect().height),g(o,{location:r,roles:(0,b.withLangRole)(O,i)}),u(),setTimeout((()=>(0,y.smoothyScrollTo)(e,300)),0)}),[o,u,O,r,i,g]);return e.createElement(n.default,{onClose:u,title:`${(0,f.getStringByKey)("title-add-to-all-pages")}?`,notDraggable:!0,withOverlay:!0},e.createElement("div",{className:a(P.default.container,"px-16 pb-24 pt-16")},e.createElement(s.default,null,m[r]),e.createElement(c.default,{mixClassName:"mt-16"},e.createElement(l.default,{className:"primary size-small",mixClassName:"mr-8",onClick:h},(0,f.getStringByKey)("add-to-all-pages")),e.createElement(l.default,{className:"size-small",onClick:u},(0,f.getStringByKey)("only-to-this-page")))))}))}).call(this,o(0),o(14),o(17))},9417:function(e,t,o){"use strict";o.r(t),t.default={container:"container_O4O"}},9418:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockEpic=void 0;var i=r(o(3)),n=o(1691),c=o(1741),l=o(1967),s=o(2025),p=o(1711),d=o(1746);function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const f=["content","modifier","name","roles","categories","anchorName"];t.cloneBlockEpic=(t,o)=>t.ofType(n.CLONE_BLOCK).filter((t=>{let{payload:{id:a}}=t;return e.pipe((e=>(0,n.makeBlockSelector)()(e,a)),e.overEvery(e.negate(p.isGlobalFooter),e.negate(p.isRemoved)))(o.value)})).withLatestFrom(o).map((t=>{let[{payload:{id:o,location:r}},i]=t;const u=(0,n.makeBlockSelector)()(i,o),y=(0,c.getCurrentPage)(i),O=(0,d.getCurrentPage)(i),E=(0,s.selectOwnBlocksByPageId)(O,i),b=(0,p.isGlobalHeader)(u),P="header"===r,h=e.pipe(e.pick(f),a.when(e.always(b&&!P),e.set("roles",((t,o)=>e.filter(e.negate(e.startsWith("@lang:")),e.uniq(e.concat(e.get("roles",t),(0,l.getPushMergeBlocksRoles)(t.anchor,o)))))(u,y))))(u),m=e.pipe(e.get("sortOrder"),e.add(1))(u),T=e.pipe(e.values,e.sortBy("sortOrder"),e.findIndex(e.propEq("id",o)),e.add(1))(E),_=g(g({location:r||(0,p.genLocation)(O)},P?{sortOrder:m}:{position:T}),h);return(0,n.createBlockAction)(o,_,P)}))}).call(this,o(17),o(29))},9419:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBlockToPagesEpic=void 0;var r=a(o(3)),i=a(o(23)),n=o(386),c=o(1873),l=o(253),s=o(1691),p=o(1958),d=o(3133),u=o(1746),g=o(1711),f=o(1988),y=o(2160),O=o(1708),E=o(789);const b=["categories","anchorName","askLocation"];function P(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?P(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.cloneBlockToPagesEpic=(t,o)=>t.ofType(s.CLONE_BLOCK_TO_PAGES).mergeMap((t=>{let{payload:{source:a,targetPageIds:r,createBlockProps:{categories:P,anchorName:m,askLocation:T}}}=t,_=(0,i.default)(t.payload.createBlockProps,b);const v=o.value,A=(0,O.selectWebsiteId)(v);if(((t,o)=>e.allPass([e.pipe(e.size,e.isEqual(1)),e.negate(e.includes(t))])(o))((0,u.getCurrentPage)(v),r)){const t=e.first(r),o=(0,l.getStringByKey)("language-route-prefix"),i=(0,y.selectIsDraftium)(v),p=`${"en"===o?"":o}${(0,c.getEditorInnerLink)(`${i?"structure":"website"}/${A}/${t}`)}`;return n.Observable.of((0,f.preChangeLocationAction)({path:p,onPageReadyAction:(0,s.createBlockAction)(a,h(h({},_),{},{location:(0,g.genLocation)(t),anchorName:m,categories:P,sortOrder:d.SORT_POSITION_BOTTOM}))}))}const w=(0,p.incrementAnchor)({anchorName:m,blocks:v.blocks,categories:P}),S=h(h({},_),{},{anchorName:w,categories:P}),j=e.pipe(e.size,e.isEqual(1))(r),k=r.map((e=>{const t=(0,g.genLocation)(e);return(0,s.createBlockAction)(a,h({location:t,sortOrder:d.SORT_POSITION_BOTTOM,noScroll:!j},S))}));return j||(0,E.addToaster)({type:"success",timer:3e3,message:(0,l.getStringByKey)("copy-block-to-pages-success")}),n.Observable.from(k)}))}).call(this,o(17))},9420:function(e,t,o){"use strict";var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"cloneBlockToLanguagesEpic",{enumerable:!0,get:function(){return r.default}});var r=a(o(9421))},9421:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o(3)),i=a(o(23)),n=a(o(541)),c=o(1691),l=o(1708),s=o(386),p=o(789),d=o(535),u=o(1698),g=o(1988),f=o(1873),y=o(2039),O=o(1777),E=o(9422);const b=["roles","location"];function P(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?P(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.default=(t,o)=>t.ofType(c.CLONE_BLOCK_TO_LANGUAGES).withLatestFrom(o).switchMap((async t=>{let[o,a]=t,{payload:{source:r,targetLanguages:P,createBlockProps:{roles:m,location:T}}}=o,_=(0,i.default)(o.payload.createBlockProps,b);const v=(0,l.selectWebsiteId)(a),A=(0,u.homepageSelector)(a),w=(0,u.selectPagesByLangGroup)(A.langGroup,a),S=await(0,d.getBlocksByLocations)(["header","footer"],v,{roles:{$ne:"removed"}}),j=e.filter(e.pipe(e.get("location"),e.equals(T)),S);if(e.pipe(e.size,e.isEqual(1))(P)){const t=e.first(P),o=n.default.t("language-route-prefix"),i=(0,E.isBlockExistsOnLanguage)(t,j),l=(0,E.findPageByLang)(t,w),p=(0,y.selectIsDraftium)(a),d=e.pipe(e.concat((0,E.withEntityType)(p)),e.join("/"),f.getEditorInnerLink,(0,E.maybeWithLangPrefix)(o))([v,l.id]);return s.Observable.of((0,g.preChangeLocationAction)({path:d,onPageReadyAction:(0,c.createBlockAction)(r,h({roles:(0,E.getNewRoles)(i,t,m),location:(0,E.maybeGenLocation)(i,l,T),sortOrder:(0,E.getSortOrder)(T)},_))}))}const k=e.pipe(e.map((e=>{const t=(0,E.isBlockExistsOnLanguage)(e,j),o=(0,E.findPageByLang)(e,w);return(0,c.createBlockAction)(r,h({roles:(0,E.getNewRoles)(t,e,m),location:(0,E.maybeGenLocation)(t,o,T),sortOrder:(0,E.getSortOrder)(T)},_))})))(P);return(0,p.addToaster)({type:"success",eventId:"copy-block-to-another-language",timer:3e3,message:n.default.t("copy-block-to-another-language-success",{languages:e.pipe(e.map((e=>(0,O.formatLanguageCode)(e))),e.join(", "))(P)}),unique:!0}),s.Observable.from(k)})).switchMap(e.identity)}).call(this,o(17))},9422:function(e,t,o){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.withEntityType=t.maybeWithLangPrefix=t.maybeGenLocation=t.isBlockExistsOnLanguage=t.getSortOrder=t.getNewRoles=t.findPageByLang=void 0;var r=o(1711),i=o(1777),n=o(3133);t.isBlockExistsOnLanguage=e.curry(((t,o)=>e.pipe(e.some(e.pipe(e.get("roles"),e.includes(`@lang:${t}`))))(o))),t.findPageByLang=e.curry(((t,o)=>e.pipe(e.find(e.pipe(e.get("lang"),e.eq(t))))(o)));t.getNewRoles=(t,o,r)=>e.pipe(i.withoutLangRoles,a.unless(e.always(t),(0,i.withLangRole)(o)))(r);t.maybeGenLocation=e.curry(((t,o,i)=>a.when(e.always(t),e.always((0,r.genLocation)(o.id)))(i)));t.getSortOrder=e=>(0,r.isGlobalHeader)({location:e})?n.SORT_POSITION_TOP:n.SORT_POSITION_BOTTOM;t.maybeWithLangPrefix=e.curry(((e,t)=>`${"en"===e?"":e}${t}`));t.withEntityType=e=>e?"structure":"website"}).call(this,o(17),o(29))},9423:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"toggleHiddenStatusOnAllPagesEpic",{enumerable:!0,get:function(){return a.toggleHiddenStatusOnAllPagesEpic}});var a=o(9424)},9424:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.toggleHiddenStatusOnAllPagesEpic=void 0;var a=o(386),r=o(1691),i=o(1711),n=o(1698),c=o(789),l=o(253),s=o(1947),p=o(1982),d=o(1967),u=o(1688),g=o(1677),f=o(1683),y=o(1746),O=o(4133),E=o(4385);t.toggleHiddenStatusOnAllPagesEpic=(t,o)=>{const b=(0,r.makeBlockSelector)();return t.ofType(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,(0,u.withUndoType)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES),(0,u.withRedoType)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)).withLatestFrom(o).switchMap((t=>{let[{type:o,payload:{blockId:P,deviceType:h,pages:m,isHidden:T}},_]=t;const v=(0,y.getCurrentPage)(_),A=m[v],w=b(_,P),S=(0,i.mergeBlockPropsFromPage)(A,w);if(e.negate(i.isSpawning)(w))return[];const j=e.includes(h,[...g.ALL_DEVICES,g.ALL_DEVICE_TYPE])?h:(0,f.selectCurrentDevice)(_),k=(0,O.getPageIdsToToggle)({currentPageId:v,isHidden:T,anchor:S.anchor,deviceType:j,pages:m});if(!k.length)return[];const C=(0,u.withUndoType)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)===o;C||(0,c.addToaster)({eventId:"blockVisibility",message:(0,l.getStringByKey)("we-have-changed-the-block-visibility"),actionConfig:{type:"custom",text:(0,l.getStringByKey)("undo"),icon:{name:"undo-ico"},onClick:()=>{const e=(0,s.getStore)(),t=(0,r.selectBlocks)(_);(0,p.undoAction)(e.dispatch)(t,{actionToUndo:(0,r.toggleHiddenStatusOnAllPagesAction)({blockId:P,deviceType:h,pages:m,isHidden:T})})}},type:"success",unique:!0,timer:5e3});const M=e.map((t=>{const o=m[t];let a=o.merge_blocks;if(!C){const t=j===g.ALL_DEVICE_TYPE&&!T,r=(0,d.getPushMergeBlocksRoles)(S.anchor,o),i=t?[]:e.sortBy(e.identity,(0,E.toggleHiddenRoles)(j,{roles:r}));a=(0,d.setPushMergeBlocksRoles)(S.anchor,o,i)}return(0,n.updatePageAction)({pageId:t,data:{merge_blocks:a}},{ignoreHistory:!0})}))(k);return a.Observable.from(M)}))}}).call(this,o(17))},9425:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.removeBlockEpic=void 0;var a=o(1691),r=o(1688);t.removeBlockEpic=(t,o)=>t.ofType(a.REMOVE_BLOCK,(0,r.withUndoType)(a.REMOVE_BLOCK)).mergeMap((async t=>{let{payload:{id:r}}=t;const i=e.get(["blocks",r,"roles"])(o.value)||[];return(0,a.removeBlockFulfilledAction)(r,{roles:[...i,"removed"]})}))}).call(this,o(17))},9426:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.serverUpdateBlockEpic=void 0;var r=o(386),i=o(2349),n=o(2616),c=o(1688),l=o(1691),s=o(535),p=a(o(3632));t.serverUpdateBlockEpic=(t,o)=>{const a=e=>o.value.blocks[e],d=(0,c.withPermissionType)((0,c.withFulfilledType)(l.UPDATE_BLOCK)),u=(0,c.withPermissionType)((0,c.withFulfilledType)(l.REMOVE_BLOCK)),g={};return t.ofType(d,u).filter((e=>{let{payload:{block:{__TESTUPDATE__:t}}}=e;return!t})).mergeMap((async t=>p.default.lock((async()=>{const{payload:{block:r,id:c}}=t,l=g[c]=g[c]||{last:Promise.resolve(),nextArgs:t};return l.nextArgs=t,await l.last.catch((()=>{})),l.nextArgs===t&&(l.last=(async()=>{try{const t=e.pick(e.keys(r));let i,n=t(a(c));do{i=n,await(0,s.updateBlock)({id:c,data:i,websiteId:e.get("website._id")(o.value)}),n=t(a(c))}while(!e.isEqual(i)(n))}catch(p){try{const t=await(t=>e.get(["blocks",t])(o.value))(c);return[t]}catch(d){return[]}}finally{l.nextArgs===t&&([n.READY,n.LOADING].includes((0,i.getEditorStatus)())||(0,i.changeEditorStatus)(n.SAVED),delete g[c])}})()),l.last})))).mergeMap(e.spread(r.Observable.of))}}).call(this,o(17))},9427:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.updateBlockEpic=t.getTagsToUpdate=void 0;var i=r(o(3)),n=o(386),c=o(1688),l=(o(1745),o(1691));function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const d="try_it_free",u=e.pipe(e.get("content.__constructor__.nodes"),e.any(e.propEq("type","TryItFree"))),g=(t,o)=>e.pipe(e.get("tags"),a.ifElse(e.always(t),e.pipe(a.push(d),e.uniq),e.pull(d)))(o);t.getTagsToUpdate=g;t.updateBlockEpic=(e,t)=>{const o=(0,l.makeBlockSelector)();return e.ofType(l.UPDATE_BLOCK,(0,c.withRedoType)(l.UPDATE_BLOCK),(0,c.withUndoType)(l.UPDATE_BLOCK)).mergeMap((a=>{let{payload:{id:r,block:i,onUpdateBlockAction:s},type:d}=a;const f=u(i),y=o(t.value,r),O=g(f,y);return n.Observable.merge(n.Observable.of((0,c.withPermission)((0,l.updateBlockFulfilledAction)(r,p(p({},i),{},{tags:O}),d))).filter(Boolean),e.ofType((0,c.withPermissionType)((0,c.withFulfilledType)(l.UPDATE_BLOCK))).take(1).do((()=>s&&s())).ignoreElements())}))}}).call(this,o(17),o(29))},9428:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateToSourceEpic=void 0;var a=o(1691),r=o(535),i=o(1688);t.updateToSourceEpic=e=>e.ofType(a.UPDATE_TO_SOURCE,(0,i.withUndoType)(a.UPDATE_TO_SOURCE),(0,i.withRedoType)(a.UPDATE_TO_SOURCE)).switchMap((async e=>{let{payload:{id:t,sourceVersion:o,sourceId:i}}=e;const{viewRef:n,version:c,name:l,source:s,roles:p}=await(0,r.updateBlockToSource)({id:t,sourceId:i,sourceVersion:o});return(0,a.updateToSourceFulfilledAction)({id:t,viewRef:n,version:c,name:l,source:s,roles:p})}))},9429:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.updateBlockModifierEpic=void 0;var r=a(o(3)),i=o(1691),n=o(2084);function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.updateBlockModifierEpic=(t,o)=>{const a=(0,i.makeBlockSelector)();return t.ofType(i.UPDATE_BLOCK_MODIFIER).withLatestFrom(o).map((t=>{let[{payload:{id:o,prop:r,value:c}},s]=t;const p=a(s,o),{modifier:d,viewRef:u}=p,g=JSON.parse(d||null);if(e.isEqual(e.get(r,g),c))return;const f=(0,n.getView)(u),y=e.getOr({},"modifierScheme",f),O=e.getOr(e.noop,[r,"join"])(y),E=e.set(r,c,g);return(0,i.updateBlockAction)(o,{modifier:JSON.stringify(l(l({},E),O(E)))})})).filter(Boolean)}}).call(this,o(17))},9430:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uiKitEpic=void 0;var a=o(2024),r=o(9431),i=o(3855),n=o(3853);t.uiKitEpic=(0,a.combineEpics)(r.changeCurrentUiKitPreset,i.changePaletteColorsEpic,i.updateWebsiteColorsEpic,n.fetchUIKitEpic,r.changeCurrentUikitTypography,i.changeTypographySettingsEpic,i.updateWebsiteTypographyEpic,r.changeCurrentUikitButtonPreset,i.changeButtonSettingsEpic,i.externalChangeButton,i.externalChangePalette,i.externalChangeTypography)},9431:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.changeCurrentUikitTypography=t.changeCurrentUikitButtonPreset=t.changeCurrentUiKitPreset=void 0;var r=a(o(3)),i=o(386),n=o(2316),c=o(1809),l=o(535),s=o(1737),p=o(2486),d=o(2253),u=o(2487),g=o(1688);function f(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function y(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?f(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.changeCurrentUiKitPreset=(t,o)=>t.ofType(c.CHANGE_CURRENT_PRESET,(0,g.withRedoType)(c.CHANGE_CURRENT_PRESET),(0,g.withUndoType)(c.CHANGE_CURRENT_PRESET)).mergeMap((async e=>{let{payload:{id:t,previousSelection:a}}=e;try{const{uikitTypography:e,uikitButton:r,_id:d}=o.value.website,{uikitPalette:u}=await(0,l.updateWebsite)({id:d,data:{uikitPalette:t},payload:{type:"uikit"}}),g=await(0,p.getColorPalette)({id:u}),f=(0,s.generateUIKit)({uikitTypography:e,uikitButton:r,uikitPalette:g});return i.Observable.of((0,c.changeCurrentPresetFulfilledAction)(y(y({},g),{},{previousSelection:a})),(0,n.fetchUIKitFulfilledAction)(f))}catch(r){return[]}})).switchMap(e.identity);t.changeCurrentUikitTypography=(t,o)=>t.ofType(c.CHANGE_CURRENT_TYPOGRAPHY,(0,g.withRedoType)(c.CHANGE_CURRENT_TYPOGRAPHY),(0,g.withUndoType)(c.CHANGE_CURRENT_TYPOGRAPHY)).mergeMap((async e=>{let{payload:{id:t}}=e;try{const{uikitButton:e,uikitPalette:a,_id:r}=o.value.website,{uikitTypography:p}=await(0,l.updateWebsite)({id:r,data:{uikitTypography:t},payload:{type:"uikit"}}),u=await(0,d.getTypographyPreset)({id:p}),g=(0,s.generateUIKit)({uikitTypography:u,uikitButton:e,uikitPalette:a});return(0,s.loadGoogleFontsFromUiKit)(g),i.Observable.of((0,c.changeCurrentTypographyFulfilledAction)(u),(0,n.fetchUIKitFulfilledAction)(g))}catch(a){return[]}})).switchMap(e.identity);t.changeCurrentUikitButtonPreset=(t,o)=>t.ofType(c.CHANGE_CURRENT_BUTTON_PRESET).mergeMap((async e=>{let{payload:{id:t}}=e;try{const{uikitTypography:e,uikitPalette:a,_id:r}=o.value.website,{uikitButton:p}=await(0,l.updateWebsite)({id:r,data:{uikitButton:t},payload:{type:"uikit"}}),d=await(0,u.getButtonPreset)({id:p}),g=(0,s.generateUIKit)({uikitTypography:e,uikitButton:d,uikitPalette:a});return(0,s.loadGoogleFontsFromUiKit)(g),i.Observable.of((0,c.changeCurrentButtonPresetFulfilledAction)(d),(0,n.fetchUIKitFulfilledAction)(g))}catch(a){return[]}})).switchMap(e.identity)}).call(this,o(17))},9432:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBlockTemplatesEpic=void 0;var a=o(386),r=o(2909),i=o(535);t.fetchBlockTemplatesEpic=e=>e.ofType(r.FETCH_BLOCK_TEMPLATES).mergeMap((e=>{let{payload:{filter:t}}=e;return a.Observable.fromPromise((0,i.getBlockTemplates)(t)).map((e=>(0,r.fetchBlockTemplatesFulfilledAction)({blockTemplates:e})))}))},9433:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchViewsEpic=void 0;var r=o(386),i=o(2084),n=o(4138),c=o(2556),l=a(o(2903)),s=a(o(3916));t.fetchViewsEpic=t=>t.ofType(c.FETCH_VIEW).distinct(e.path(["payload","viewRef"])).mergeMap((async e=>{let{payload:{viewRef:t,pageId:o,view:a}}=e;const r=await(0,n.getView)(t,a),{styles:p}=r;return(0,i.setView)(t,(0,l.default)(p)((0,s.default)(r))),[(0,c.fetchViewFulfilledAction)(t)].filter(Boolean)})).switchMap(e.apply(r.Observable.of))}).call(this,o(17))},9434:function(e,t,o){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.updateWebsiteEpic=t.getWebsiteAppsEpic=t.fetchWebsiteEpic=void 0;var r=o(1873),i=o(1879),n=o(1809),c=o(1745),l=o(2293),s=o(2658),p=o(2320),d=o(1904),u=o(535),g=o(3015);t.fetchWebsiteEpic=(t,o)=>t.ofType(n.FETCH_WEBSITE).filter((e=>{let{payload:{websiteId:t}}=e;return t})).switchMap((async t=>{let{payload:i,payload:{websiteId:f}}=t;window.websiteId=f;let y,O={};try{O=await(0,u.getWebsiteById)(f),O.publishedDomains=await(0,u.getWebsitePublishedDomains)(f),y=(O.roles||[]).includes("structure")}catch(h){return console.error(h),[]}const{builderType:E}=o.value;if((O.roles||[]).includes("future"))return(0,r.redirectTo)(y?"prototype":"website"),[];const b="comment"===E,P=e.pipe(e.concat([(0,n.fetchWebsiteFulfilledAction)(O),(0,p.fetchCoreThemeAction)(),(0,p.fetchPublicThemesAction)(),(0,p.fetchWebsiteThemeAction)(),(0,c.fetchPagesAction)(i),(0,l.fetchCommentsAction)(f),(0,s.fetchOrgAction)()]),a.unless(e.always(b),e.concat([(0,g.fetchLastCustomShapeTypeAction)(f)])))([]);return O.history||b||await(0,u.removeBlocks)(O._id).catch(e.noop),!b&&await(0,d.registerWebsiteApps)(O,"editor"),P})).mergeMap(e.identity);t.getWebsiteAppsEpic=(e,t)=>e.ofType(n.GET_WEBSITE_APPS).switchMap((async()=>{const{website:{_id:e}}=t.value;try{const t=await(0,i.getWebsiteApps)({id:e});return(0,n.updateWebsiteFulfilled)({apps:t})}catch(o){console.log("cant update website")}}));t.updateWebsiteEpic=(e,t)=>e.ofType(n.UPDATE_WEBSITE).switchMap((async e=>{let{payload:o}=e;const{website:{_id:a}}=t.value;try{return await(0,u.updateWebsite)({id:a,data:o}),(0,n.updateWebsiteFulfilled)(o)}catch(r){console.log("cant update website")}})).filter(Boolean)}).call(this,o(17),o(29))},9435:function(e,t,o){"use strict";(function(e){var a=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.undoRedoEpic=t.externalUpdateUndo=void 0;var r=a(o(23)),i=a(o(3)),n=o(2024),c=o(2023),l=o(386),s=o(1691),p=o(1745),d=o(1809),u=o(1856),g=o(1688),f=o(2554),y=o(1982),O=o(2374),E=a(o(9436)),b=a(o(9437)),P=a(o(9438)),h=a(o(9439));const m=["value"],T=["value"];function _(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?_(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):_(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const A=function(t,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{id:r,ignoreHistory:i}=t.payload,{anchorName:n,content:c=null,modifier:l="",roles:p,location:d}=e.get(["blocks",r])(o);return(0,O.createPointData)(s.UPDATE_BLOCK,{id:r,block:v({content:c,modifier:l,anchorName:n,roles:p||[],location:d},a),ignoreHistory:i},o,{location:d})};t.externalUpdateUndo=e=>e.ofType(u.EXTERNAL_UPDATE).map((()=>{(0,y.resetUndoStack)(),(0,y.resetRedoStack)(),(0,y.notifySubs)()})).filter(Boolean);t.undoRedoEpic=(0,n.combineEpics)(E.default,b.default,h.default,P.default,((t,o)=>l.Observable.merge(t.ofType(s.UPDATE_BLOCK,s.REMOVE_BLOCK).do((e=>{(0,y.addUndoPoint)(A(e,o.value))})),t.ofType((0,g.withUndoType)(s.UPDATE_BLOCK),(0,g.withUndoType)(s.REMOVE_BLOCK)).do((e=>{(0,y.addRedoPoint)(A(e,o.value))})),t.ofType(s.CHANGE_SORT_ORDER,(0,g.withUndoType)(s.CHANGE_SORT_ORDER)).do((e=>{const{payload:{id:t}}=e,{blocks:a}=o.value,r=(0,f.sortBlocks)(a),i=r.indexOf(t);let n,c;i===r.length-1?(n=r[i-1],c="after"):(n=r[i+1],c="before");const l=(0,O.createPointData)(s.CHANGE_SORT_ORDER,{id:t,targetId:n,position:c},{scrollToBlockId:n});e.type===s.CHANGE_SORT_ORDER?(0,y.addUndoPoint)(l):e.type===(0,g.withUndoType)(s.CHANGE_SORT_ORDER)&&(0,y.addRedoPoint)(l)})),t.ofType((0,g.withFulfilledType)(s.CREATE_BLOCK)).do((e=>{const{payload:{id:t}}=e;(0,y.addUndoPoint)((0,O.createPointData)(s.REMOVE_BLOCK,{id:t},o.value))})),t.ofType(d.CHANGE_CURRENT_PRESET).do((e=>{const t=o.value,{payload:{previousSelection:a,id:r}}=e,{website:{uikitPalette:{color:i,source:n}}}=t,c={id:a,previousSelection:r,color:i,source:n};(0,y.addUndoPoint)((0,O.createPointData)(a?(0,g.extractUndoRedoActionType)(e.type):d.CHANGE_PALETTE_COLORS,c,t,{noScroll:!0}))})),t.ofType((0,g.withUndoType)(d.CHANGE_CURRENT_PRESET)).do((e=>{const t=o.value,{website:{uikitPalette:{color:a,source:r}}}=t,{payload:{previousSelection:i,id:n}}=e;(0,y.addRedoPoint)((0,O.createPointData)((0,g.extractUndoRedoActionType)(e.type),{id:i,previousSelection:n,color:a,source:r},t,{noScroll:!0}))})),t.ofType(d.CHANGE_PALETTE_COLORS).do((()=>{const e=o.value,{website:{uikitPalette:{color:t}}}=e;(0,y.addUndoPoint)((0,O.createPointData)(d.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))})),t.ofType((0,g.withUndoType)(d.CHANGE_PALETTE_COLORS)).do((()=>{const e=o.value,{website:{uikitPalette:{color:t}}}=e;(0,y.addRedoPoint)((0,O.createPointData)(d.CHANGE_PALETTE_COLORS,{color:t},e,{noScroll:!0}))})),t.ofType(c.LOCATION_CHANGE).map((e=>{let{payload:{location:{pathname:t,state:o}}}=e;return{pathname:t,state:o}})).distinctUntilChanged(e.isEqual).do((t=>{let{pathname:o,state:a}=t;a&&a.previewPath||(0,y.changePage)(e.pipe(e.split("/"),e.last)(o))})),t.ofType(p.CHANGE_PAGES_METADATA_PROP).do((e=>{const{payload:{value:t},meta:{ignoreHistory:a}}=e,i=(0,r.default)(e.payload,m);(0,y.addUndoPoint)((0,O.createPointData)(p.CHANGE_PAGES_METADATA_PROP,v(v({value:!t},i),{},{ignoreHistory:a}),o.value,{noScroll:!0}))})),t.ofType((0,g.withUndoType)(p.CHANGE_PAGES_METADATA_PROP)).do((e=>{const{payload:{value:t}}=e,a=(0,r.default)(e.payload,T);(0,y.addRedoPoint)((0,O.createPointData)(p.CHANGE_PAGES_METADATA_PROP,v({value:!t},a),o.value,{noScroll:!0}))})),t.ofType(s.UPDATE_TO_SOURCE).do((t=>{let{payload:{id:a,sourceId:r}}=t;const i=o.value,n=e.get(`blocks[${a}].source._id`,i);if(n!==r){const t=e.get(`block[${n}]`,i);(0,y.addUndoPoint)((0,O.createPointData)(s.UPDATE_TO_SOURCE,{id:a,sourceId:n,sourceVersion:t},i))}})),t.ofType((0,g.withUndoType)(s.UPDATE_TO_SOURCE)).do((t=>{let{payload:{id:a,sourceId:r}}=t;const i=o.value,n=e.get(`blocks[${a}].source._id`,i);if(n!==r){const t=e.get(`block[${n}]`,i);(0,y.addRedoPoint)((0,O.createPointData)(s.UPDATE_TO_SOURCE,{id:a,sourceId:n,sourceVersion:t},i))}})),t.ofType(p.REMOVE_PAGE).do((e=>{const{payload:{pageId:t}}=e;(0,y.filterStacks)({pageId:t})}))).filter(e.F)))}).call(this,o(17))},9436:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(1698),r=o(1982),i=o(1688),n=o(386),c=o(2374);t.default=(t,o)=>n.Observable.merge(t.ofType(a.UPDATE_PAGE).withLatestFrom(o).do((t=>{let[{payload:{pageId:o,data:i},meta:{ignoreHistory:n}},l]=t;const s=l.pages[o],p=e.keys(i),d=e.pick(p,s),u=(0,c.createPointData)(a.UPDATE_PAGE,{pageId:o,data:d,ignoreHistory:n},l,{noScroll:!0});(0,r.addUndoPoint)(u)})),t.ofType((0,i.withUndoType)(a.UPDATE_PAGE)).withLatestFrom(o).do((t=>{let[{payload:{pageId:o,data:i},meta:{ignoreHistory:n}},l]=t;const s=l.pages[o],p=e.keys(i),d=e.pick(p,s),u=(0,c.createPointData)(a.UPDATE_PAGE,{ignoreHistory:n,pageId:o,data:d},l,{noScroll:!0});(0,r.addRedoPoint)(u)}))).filter(e.F)}).call(this,o(17))},9437:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(1691),r=o(2374),i=o(1982),n=o(1688),c=o(386);t.default=(t,o)=>c.Observable.merge(t.ofType(a.TOGGLE_HIDDEN_STATUS).withLatestFrom(o).do((e=>{let[{payload:{id:t,deviceType:o}},n]=e;const c=(0,r.createPointData)(a.TOGGLE_HIDDEN_STATUS,{id:t,deviceType:o},n,{noScroll:!0});(0,i.addUndoPoint)(c)})),t.ofType((0,n.withUndoType)(a.TOGGLE_HIDDEN_STATUS)).withLatestFrom(o).do((e=>{let[{payload:{id:t,deviceType:o}},n]=e;const c=(0,r.createPointData)(a.TOGGLE_HIDDEN_STATUS,{id:t,deviceType:o},n,{noScroll:!0});(0,i.addRedoPoint)(c)}))).filter(e.F)}).call(this,o(17))},9438:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(1698),r=o(1982),i=o(2374),n=o(1688),c=o(386);t.default=(t,o)=>c.Observable.merge(t.ofType(a.CHANGE_PAGE_METADATA).withLatestFrom(o).do((t=>{let[{payload:{pageId:o,metadata:n},meta:{ignoreHistory:c}},l]=t;const s=e.path([o,"metadata"])(l.pages),p=e.findKey(e.path(["metadata","homepage"]),l.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([s,n])&&(0,r.addUndoPoint)((0,i.createPointData)(a.CHANGE_PAGE_METADATA,{pageId:o,metadata:s,ignoreHistory:c},l,{noScroll:!0,pageId:o})),n.homepage&&n.homepage!==s.homepage&&p&&(0,r.addUndoPoint)((0,i.createPointData)(a.CHANGE_PAGE_METADATA,{pageId:p,metadata:l.pages[p].metadata,ignoreHistory:c},l,{noScroll:!0}))})),t.ofType((0,n.withUndoType)(a.CHANGE_PAGE_METADATA)).withLatestFrom(o).do((t=>{let[{payload:{pageId:o,metadata:n}},c]=t;if(!c.pages[o])return;const l=e.path([o,"metadata"],c.pages),s=e.findKey(e.path(["metadata","homepage"]),c.pages);e.pipe(e.map(e.omit(["homepage"])),e.apply(e.complement(e.equals)))([l,n])&&(0,r.addRedoPoint)((0,i.createPointData)(a.CHANGE_PAGE_METADATA,{pageId:o,metadata:l},c,{noScroll:!0,pageId:o})),n.homepage&&n.homepage!==l.homepage&&s&&(0,r.addRedoPoint)((0,i.createPointData)(a.CHANGE_PAGE_METADATA,{pageId:s,metadata:c.pages[s].metadata},c,{noScroll:!0}))}))).filter(e.F)}).call(this,o(17))},9439:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(386),r=o(1691),i=o(2374),n=o(1982),c=o(1688);t.default=(t,o)=>a.Observable.merge(t.ofType(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES).withLatestFrom(o).do((e=>{let[{payload:{blockId:t,deviceType:o,pages:a,isHidden:c}},l]=e;const s=(0,i.createPointData)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,{blockId:t,deviceType:o,pages:a,isHidden:c},l,{noScroll:!0});(0,n.addUndoPoint)(s)})),t.ofType((0,c.withUndoType)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES)).withLatestFrom(o).do((e=>{let[{payload:{blockId:t,deviceType:o,pages:a,isHidden:c}},l]=e;const s=(0,i.createPointData)(r.TOGGLE_HIDDEN_STATUS_ON_ALL_PAGES,{blockId:t,deviceType:o,pages:a,isHidden:c},l,{noScroll:!0});(0,n.addRedoPoint)(s)}))).filter(e.F)}).call(this,o(17))},9440:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.themesEpic=void 0;var i=r(o(3)),n=o(386),c=o(2320),l=o(535),s=o(2315),p=o(9441);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}t.themesEpic=(t,o)=>n.Observable.merge(t.ofType(c.FETCH_PUBLIC_THEMES).switchMap((async()=>{const e=await(0,l.getPublicThemes)();return(0,c.fetchPublicThemesFulfilledAction)({themes:e})})),t.ofType(c.FETCH_CORE_THEME).switchMap((async()=>n.Observable.of((0,c.fetchCoreThemeFulfilledAction)({theme:await(0,l.getCoreTheme)()||null})))).switchMap(e.identity),t.ofType(c.FETCH_WEBSITE_THEME).switchMap((async()=>{const t=await(0,l.getWebsiteThemes)(e.get("website._id")(o.value)),[r,i]=e.pipe(a.keyToProp("id"),e.sortBy(e.pipe(e.prop("createdAt"),a.construct(Date))),e.juxt([e.last,e.initial]))(t);return n.Observable.of((0,c.fetchWebsiteThemeFulfilledAction)({theme:r||null}),...e.map(c.removeThemeAction,i))})).switchMap(e.identity),t.ofType(c.USE_PUBLIC_THEME).switchMap((async t=>{let{payload:{id:a}}=t;const r=o.value,i=e.get("themes.websiteTheme.id")(r),s=e.get("website._id")(r),p=await(0,l.createTheme)({websiteId:s,source:a});return n.Observable.of(...e.compact([(0,c.usePublicThemeFulfilledAction)(p),i&&(0,c.removeThemeAction)({id:i})]))})).switchMap(e.identity),t.ofType(c.REMOVE_THEME).switchMap((async e=>{let{payload:{id:t}}=e;const o=await(0,l.removeTheme)(t);return(0,c.removeThemeFulfilledAction)(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({id:t},o))})),t.ofType(c.UPDATE_THEME_TO_SOURCE).switchMap((async e=>{let{payload:{id:t,sourceId:o}}=e;return(0,c.updateThemeToSourceFulfilledAction)(await(0,l.updateBlockToSource)({id:t,sourceId:o}))})),t.ofType(c.FETCH_THEME_RENDERER).distinct(e.get("payload.viewRef")).mergeMap((async e=>{let{payload:{viewRef:t}}=e;const o=await(0,p.getTheme)(t);return(0,s.setTheme)(t,o),(0,c.fetchThemeRendererFulfilledAction)({viewRef:t})})))}).call(this,o(17),o(29))},9441:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTheme=void 0;var a=o(3861);const r=e=>{if("weblium/editor"===e)return o(4139);throw new Error(`Invalid required path ${e}`)};t.getTheme=e=>(0,a.buildTheme)({viewRef:e,requireInjector:r})},9442:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.modalsEpic=void 0;var i=r(o(3)),n=o(386),c=o(1895),l=o(1670),s=o(781);function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.modalsEpic=t=>n.Observable.merge(t.filter(e.propSatisfies("type",a.anyPass([a.endsWith("@UNDO_PROCEED"),a.endsWith("@REDO_PROCEED")]))).mergeMap((()=>n.Observable.of((0,c.closeAllModalsAction)()))),t.ofType(c.CLOSE_ALL_MODALS).mergeMap((()=>{const{hash:e}=a.filter("hash",(0,l.getOpenedModals)())[0]||{},t=(0,s.getHistory)();return t.location.hash===e&&t.push(d(d({},t.location),(0,l.getSavedLocation)())),n.Observable.of((0,c.closeAllModalsActionFulfilled)())})))}).call(this,o(29),o(17))},9443:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.commentsEpic=void 0;var a=o(386),r=o(2293),i=o(535);const n=t=>o=>o?e.update("block.ref",t)(o):o;t.commentsEpic=(t,o)=>a.Observable.merge(t.ofType(r.FETCH_COMMENTS).switchMap((async e=>{const{websiteId:t}=e.payload;try{const e=await(0,i.fetchComments)(t);return(0,r.fetchCommentsFulfilledAction)(e)}catch(o){return console.log(o),(0,r.fetchCommentsFulfilledAction)([])}})),t.ofType(r.ADD_COMMENT_CONFIRM).mergeMap((async t=>{const{payload:{comment:a,tempId:c}}=t,{website:{_id:l},blocks:s}=o.value,p=e.flow(e.omit(["id","active","pinNumber"]),e.update("location",n((e=>e?e._id:e))))(a);try{const t=await(0,i.addComment)({comment:p,websiteId:l}),o=e.update("location",n((t=>({_id:t,roles:e.getOr([],`${t}.roles`)(s)}))))(t);return(0,r.addCommentConfirmFulfilledAction)(c,o)}catch(d){return(0,r.addCommentConfirmRejectAction)(c)}})),t.ofType(r.ADD_AND_POST_COMMENT).mergeMap((async t=>{const{payload:{comment:a,commentToPost:c}}=t,{website:{_id:l},blocks:s}=o.value,{id:p,tempId:d}=c,u=e.flow(e.omit(["id","tempId","inProgress","active","pinNumber"]),e.update("location",n((e=>e?e._id:e))))(c);try{const t=await(0,i.addComment)({comment:u,websiteId:l}),o=e.update("location",n((t=>({_id:t,roles:e.getOr([],`${t}.roles`)(s)}))))(t);return(0,r.addAndPostCommentFulfilledAction)(a,o,d)}catch(g){return(0,r.addCommentConfirmRejectAction)(p)}})),t.ofType(r.UPDATE_COMMENT).mergeMap((async t=>{const{payload:{id:a,comment:n,newId:c}}=t;if(n.inProgress)return(0,r.updateCommentFulfilledAction)(a,n,c);try{const t=e.flow(e.pick(["location","text"]),e.update("location.block.ref",(e=>e?e._id:e)))(n),{website:{_id:c}}=o.value;return await(0,i.updateComment)({id:a,data:t,websiteId:c}),(0,r.updateCommentFulfilledAction)(a,n)}catch(l){console.log("comment update error",l)}})).filter(Boolean),t.ofType(r.RESOLVE_COMMENT).mergeMap((async t=>{const{payload:{id:a}}=t,{website:{_id:n}}=o.value,{comments:c}=o.value;if(e.find((e=>e.id===a))(c))try{return await(0,i.resolveComment)({id:a,websiteId:n}),(0,r.resolveCommentFulfilledAction)(a)}catch(l){console.log("comment resolve error",l)}})).filter(Boolean),t.ofType(r.UNRESOLVE_COMMENT).mergeMap((async t=>{const{payload:{id:a}}=t,{comments:n,website:{_id:c}}=o.value;if(e.find((e=>e.id===a))(n))return await(0,i.unresolveComment)({id:a,websiteId:c}),(0,r.unresolveCommentFulfilledAction)(a)})).filter(Boolean),t.ofType(r.REMOVE_COMMENT).mergeMap((async e=>{const{website:{_id:t}}=o.value,{payload:{ids:a}}=e,n=Array.isArray(a)?a:[a];try{for(const e of n)await(0,i.removeComment)({id:e,websiteId:t});return(0,r.removeCommentFulfilledAction)(n)}catch(c){console.log("remove error",c)}})).filter(Boolean))}).call(this,o(17))},9444:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.editorStatusEpic=t.SAVING_ACTIONS=void 0;var a=o(2349),r=o(2616),i=o(1688),n=o(386),c=o(1691),l=o(1745),s=o(1809);const p=t.SAVING_ACTIONS=[c.UPDATE_BLOCK,c.CREATE_BLOCK,c.REMOVE_BLOCK,c.CHANGE_SORT_ORDER,c.UPDATE_TO_SOURCE,l.CHANGE_PAGE_METADATA,l.CHANGE_PAGES_METADATA_PROP,l.REMOVE_PAGE,s.CHANGE_CURRENT_PRESET,s.CHANGE_PALETTE_COLORS,l.CREATE_PAGE,s.CHANGE_CURRENT_TYPOGRAPHY,s.CHANGE_TYPOGRAPHY_SETTINGS,s.CHANGE_CURRENT_BUTTON_PRESET,s.CHANGE_BUTTON_SETTINGS],d=p.map((e=>(0,i.withFulfilledType)(e)));t.editorStatusEpic=t=>n.Observable.merge(t.ofType(...p).do((e=>{let{type:t,payload:o}=e;(0,a.changeEditorStatus)(r.SAVING,{type:t,payload:o})})),t.ofType(...d).do((()=>{[r.READY,r.LOADING].includes((0,a.getEditorStatus)())||(0,a.changeEditorStatus)(r.SAVED)})),t.ofType((0,i.withPermissionType)(l.READY_PAGE)).do((()=>{(0,a.changeEditorStatus)(r.READY)}))).filter(e.F)}).call(this,o(17))},9445:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchOrganizationEpic=void 0;var a=o(798),r=o(2658);t.fetchOrganizationEpic=e=>e.ofType(r.FETCH_ORGANIZATION).distinctUntilChanged(((e,t)=>e.id===t.id)).switchMap((async()=>{let e;try{const t=await(0,a.getUserOrganizationsList)();e=t.length?t[0]:await(0,a.getOrganizationInfo)()}catch(t){console.error("Couldn't get user organization info",t),e={}}return(0,r.fetchOrgFulfilledAction)(e||{})}))},9446:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPopupTemplatesEpic=t.default=void 0;var a=o(386),r=o(2905),i=o(535);const n=e=>e.ofType(r.FETCH_POPUP_TEMPLATES).mergeMap((e=>{let{payload:{filter:t}}=e;return a.Observable.fromPromise((0,i.getBlockTemplates)(t)).map((e=>(0,r.fetchPopupTemplatesFulfilledAction)({popupTemplates:e})))}));t.fetchPopupTemplatesEpic=n;const c=n;t.default=c},9447:function(e,t,o){"use strict";(function(e,a){var r=o(6);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPhrasesEpic=t.default=void 0;var i=r(o(3)),n=o(386),c=o(4313),l=o(2640),s=o(1708),p=o(1798),d=o(1804),u=o(1698),g=o(1688),f=o(1856);function y(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function O(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?y(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const E=e=>e.reduce(((e,t)=>O(O({},e),{},{[t.key]:t.value})),{}),b=e.ifElse(d.defaultLanguageSelector,d.selectLanguages,a.pipe(s.selectWebsiteLanguage,Array)),P=(e,t)=>e.ofType((0,g.withPermissionType)((0,g.withFulfilledType)(u.FETCH_PAGES)),(0,g.withPermissionType)(f.EXTERNAL_PAGE_UPDATE)).withLatestFrom(t).map(a.pipe(a.nth(1),b)).distinctUntilChanged().switchMap(a.unary(n.Observable.from)).withLatestFrom(t).mergeMap((e=>{let[t,o]=e;const a=(0,s.selectWebsiteId)(o);return Promise.all([(0,c.loadDefaultPhrases)(t),(0,l.loadPhrases)(a,t).then(E)]).then((e=>{let[t,o]=e;return O(O({},t),o)})).then((e=>(0,p.fetchPhrasesFulfilledAction)(t,e)))}));t.fetchPhrasesEpic=P;t.default=P}).call(this,o(29),o(17))},9448:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.pageReadyEpic=t.default=void 0;var a=o(1698),r=o(3654),i=o(2024),n=o(386),c=o(1746),l=o(2025),s=o(2443);const p=(t,o)=>t.ofType(a.READY_PAGE).mergeMap((()=>{var t;const a=o.value,i=(0,c.getCurrentPage)(a),p=Object.values((0,s.selectBlocksWithLayoutWithoutHiddenAndRemoved)(a)).sort(((e,t)=>Number((0,l.isBlockBelongsToPage)(i,e))-Number((0,l.isBlockBelongsToPage)(i,t)))),d=null===(t=e.first(p))||void 0===t?void 0:t.id;return n.Observable.of((0,r.startBlocksLoadingAction)(d))}));t.pageReadyEpic=p;t.default=(0,i.combineEpics)(p)}).call(this,o(17))},9449:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLastCustomShapeTypeEpic=t.getLastCustomShapeTypeEpic=t.default=void 0;var a=o(2024),r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=s(t);if(o&&o.has(e))return o.get(e);var a={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(a,i,n):a[i]=e[i]}return a.default=e,o&&o.set(e,a),a}(o(3046)),i=o(2713),n=o(2027),c=o(3015),l=o(1708);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(s=function(e){return e?o:t})(e)}const p=e=>e.ofType(i.FETCH_LAST_CUSTOM_SHAPE_TYPE).switchMap((async e=>{let{payload:{id:t}}=e;const o=await r.getItem({id:t,key:n.LAST_CUSTOM_SHAPE_TYPE});return(0,c.fetchLastCustomShapeTypeFulfilledAction)(o||n.DEFAULT_CUSTOM_SHAPE_TYPE)}));t.getLastCustomShapeTypeEpic=p;const d=(e,t)=>e.ofType(i.SET_LAST_CUSTOM_SHAPE_TYPE).withLatestFrom(t).switchMap((async e=>{let[{payload:{value:t}},o]=e;const a=(0,l.selectWebsiteId)(o);return r.setItem({id:a,key:n.LAST_CUSTOM_SHAPE_TYPE,value:t}),(0,c.setLastCustomShapeTypeFulfilledAction)(t)}));t.setLastCustomShapeTypeEpic=d;t.default=(0,a.combineEpics)(p,d)}}]);
//# sourceMappingURL=epics.b6024fd560dda5cc3933.js.map